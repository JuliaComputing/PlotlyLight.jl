# This file is not included in the PlotlyLight module.
# It is a standalone script that generates files from the Plotly.js schema.
using Pkg
Pkg.activate(@__DIR__)

using JSON3, Dates

# #-----------------------------------------------------------------------------# Plotly.js
# latest = JSON3.read(download("https://api.github.com/repos/plotly/plotly.js/releases/latest")).name
# url = "https://cdn.plot.ly/plotly-$latest.min.js"


# #-----------------------------------------------------------------------------# templates
# plotly_template_urls = Dict(
#     t => "https://raw.githubusercontent.com/plotly/plotly.py/master/packages/python/plotly/plotly/package_data/templates/$t.json" for t in
#         (:ggplot2, :gridon, :plotly, :plotly_dark, :plotly_white, :presentation, :seaborn, :simple_white, :xgridoff, :ygridoff)
# )

#-----------------------------------------------------------------------------# Schema
obj = JSON3.read(read(download("https://api.plot.ly/v2/plot-schema?format=json&sha1=%27%27")))

_keys(x) = Tuple(sort!(collect(keys(x))))

traces = _keys(obj.schema.traces)
trace_defs = []

open(joinpath(@__DIR__, "..", "src", "Traces.jl"), "w") do io
    println(io, """
    # This file is automatically generated.  Do not edit this file directly.
    # Last update: $(Dates.now()) ET

    module Traces

    using ..PlotlyLight: Plot
    """)

    for t in traces
        attributes = _keys(obj.schema.traces[t].attributes)
        attributes_dict = Dict(obj.schema.traces[t].attributes)
        println(io, """
        #-----------------------------------------------------------------------------# $t
        export $t
        function $t(; kw...)
            for k in keys(kw)
                k in $attributes || @warn "Function `$t` does not have attribute `\$k`"
            end
            Plot(; type=:$t, kw...)
        end
        Base.propertynames(::typeof($t)) = $attributes

        """)
    end
    println(io, "end  # module Traces")
end
