using Pkg
Pkg.activate(@__DIR__)

using JSON3, Dates

#-----------------------------------------------------------------------------# Schema
obj = JSON3.read(read(download("https://api.plot.ly/v2/plot-schema?format=json&sha1=%27%27")))

traces = Tuple(sort!(collect(keys(obj.schema.traces))))

open(joinpath(@__DIR__, "..", "src", "trace.jl"), "w") do io
    print(io, """
    # This file is automatically generated by `deps/generate_trace.jl`.  Do not edit this file directly.
    # Last update: $(Dates.now()) ET
    const trace = let
    """)
    for t in traces
        println(io, "    $t(; kw...) = (check_attributes(:$t; kw...); Plot(; type=:$t, kw...))")
    end

    println(io, """
        (; $(join(traces, ", ")))
    end
    """)
end
