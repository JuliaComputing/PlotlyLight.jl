# This file is not included in the PlotlyLight module.
# It is a standalone script that generates files from the Plotly.js schema.
using Pkg
Pkg.activate(@__DIR__)

using JSON3, Dates

#-----------------------------------------------------------------------------# Schema
obj = JSON3.read(read(download("https://api.plot.ly/v2/plot-schema?format=json&sha1=%27%27")))

_keys(x) = Tuple(sort!(collect(keys(x))))

traces = _keys(obj.schema.traces)
trace_defs = []

bullet(key::Symbol, val::String) =  "- `$(key)`: $(val)\n"
bullet(key::Symbol, val::JSON3.Object) = bullet(key, get(val, :description, ""))

open(joinpath(@__DIR__, "..", "src", "trace.jl"), "w") do io
    print(io, """
    # This file is automatically generated.  Do not edit this file directly.
    # Last update: $(Dates.now()) ET
    const trace = let
    """)
    for t in traces
        println(io, "    $t(; kw...) = (check_attributes(:$t; kw...); Plot(; type=:$t, kw...))")
    end

    println(io, """
        (; $(join(traces, ", ")))
    end
    """)
end

# open(joinpath(@__DIR__, "..", "src", "Traces.jl"), "w") do io
#     println(io, """
    # This file is automatically generated.  Do not edit this file directly.
    # Last update: $(Dates.now()) ET

#     baremodule Traces

#     using ..PlotlyLight: Plot, schema, check_attributes
#     using Base

#     export $(join(traces, ", "))

#     const traces = $traces
#     """)

#     for t in traces
#         attributes_obj = obj.schema.traces[t].attributes
#         attributes = _keys(obj.schema.traces[t].attributes)

#         bullets = [bullet(a, attributes_obj[a]) for a in attributes]

#         print(io, """
#         $t(; kw...) = (check_attributes(:$t; kw...); Plot(; type=:$t, kw...))
#         """)
#     end
#     println(io, "end  # module Traces")
# end
